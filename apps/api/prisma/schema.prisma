// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

// User model for authentication and ownership
model User {
  id        Int      @id @default(autoincrement())
  email     String   @unique
  password  String
  firstName String?
  lastName  String?
  avatar    String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  sites     Site[]
  alerts    Alert[]

  @@index([email])
}

// Site model for monitored websites
model Site {
  id        Int      @id @default(autoincrement())
  userId    Int
  name      String
  url       String
  domain    String
  siteId    String   @unique // Public tracking ID for SDK
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  metrics   Metric[]
  alerts    Alert[]

  @@index([userId])
  @@index([siteId])
}

// Metric model for performance data
model Metric {
  id             Int      @id @default(autoincrement())
  siteId         Int
  lcp            Float?
  fid            Float?
  cls            Float?
  ttfb           Float?
  fcp            Float?
  tti            Float?
  deviceType     String
  browserName    String?
  osName         String?
  pageUrl        String?
  pageTitle      String?
  connectionType String?
  effectiveType  String?
  rtt            Int?
  downlink       Float?
  sessionId      String?
  userId         String?
  timestamp      DateTime @default(now())
  site           Site     @relation(fields: [siteId], references: [id], onDelete: Cascade)

  @@index([siteId])
  @@index([timestamp])
  @@index([deviceType])
  @@index([browserName])
}

// Alert model for performance thresholds
model Alert {
  id         Int      @id @default(autoincrement())
  userId     Int
  siteId     Int
  metricType String
  threshold  Float
  condition  String
  isActive   Boolean  @default(true)
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
  user       User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  site       Site     @relation(fields: [siteId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([siteId])
  @@index([isActive])
}
